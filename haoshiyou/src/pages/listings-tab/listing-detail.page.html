<ion-header>
    <ion-navbar>
        <ion-buttons start>
            <button ion-button *ngIf="nav.length() < 2" (click)="backToMain()">
                全部
            </button>
        </ion-buttons>
        <ion-title>{{ title ? title : '好室友™帖子'}}</ion-title>
        <ion-buttons end *ngIf="owner && meId && owner.id == meId" click="edit()">
            <button ion-button (click)="edit()">编辑</button>
        </ion-buttons>
    </ion-navbar>
</ion-header>
<ion-content id="page-container" class="grey-background">
    <ion-card *ngIf="!loading">
        <ion-item *ngIf="owner" >
            <ion-avatar *ngIf="owner.avatarSrc && owner.avatarSrc.length > 0" item-left>
                <img src="{{owner.avatarSrc}}" alt=""/>
            </ion-avatar>
            {{ owner.name }}
        </ion-item>
        <ion-item>
            <h2>{{ listing.content ? listing.title : '详情见图片' }}</h2>
            <p>{{listing.lastUpdated|timeFromNow}}</p>
        </ion-item>
        <ion-card-content>
            <p style="white-space: pre-line">{{listing.content}}</p>
        </ion-card-content>

        <!--
            We duplicate the grid and original ion-item because responsive
            grid doesn't work well with iOS yet.
            TODO(xinbenlv): remove this ion-list when works on iOS.
        -->
        <template *ngIf="!useGrid">
            <ion-item *ngFor="let imageId of listing.imageIds">
                <img src="{{ imageId | imageIdToUrlPipe:'full' }}" alt="img-{{imageId}}"
                     (click)="showImage(imageId)">
            </ion-item>
        </template>

        <ion-grid *ngIf="useGrid">
            <ion-row>
                <ion-col col-12 col-lg-3 col-md-4 col-sm-12 col-xs-12
                         *ngFor="let imageId of listing.imageIds">
                    <img src="{{ imageId | imageIdToUrlPipe:'full' }}" alt="img-{{imageId}}"
                         (click)="showImage(imageId)">
                </ion-col>
            </ion-row>
        </ion-grid>
        <ion-item *ngIf="!listing.imageIds">
            无照片
        </ion-item>
        <ion-item>
            <button ion-button color="primary" clear item-right (click)="fakeClaimAndEdit()">
                认领并编辑 <ion-icon name="flag"></ion-icon>
            </button>
            <button ion-button color="primary" clear item-right (click)="fakeStartChat()">
                私聊 <ion-icon name="chatbubbles"></ion-icon>
            </button>
        </ion-item>
    </ion-card>
    <ion-list *ngIf="loading">
        <ion-item>
            <ion-row align-items-center justify-content-center>
                <ion-spinner></ion-spinner>
            </ion-row>
        </ion-item>
    </ion-list>
</ion-content>
