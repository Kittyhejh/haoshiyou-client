<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>

    <!-- Start of Google Analytics -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-55311687-1', 'auto');
        ga('require', 'displayfeatures');
        ga('send', 'pageview');

    </script>
    <!-- End of Google Analytics -->

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="font-awesome-4.2.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="style.css"/>


</head>
<body>
<div class="container">
    <div class="outwrapper">
    <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-4 col-md-offset-4 col-lg-4 col-lg-offset-4">
        <div class="panel panel-primary ">
            <!-- Default panel contents -->
            <div class="panel-heading">
                <span id="value_panel_title" class="pull">手机版湾区租房信息互助表</span>
                <span class="pull-right" data-toggle="modal" data-target="#myModal"><i class="fa fa-search"></i></span>
            </div>

            <table class="table ">
                <tr>
                    <td><i class="fa fa-weixin"></i> 微信号</td>
                    <td id="value_wxId" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-mail-forward"></i> 电话邮箱</td>
                    <td id="value_dhyx" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-crosshairs"></i> 需求</td>
                    <td id="value_xq" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-clock-o"></i> 起始时间</td>
                    <td id="value_qssj" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-location-arrow"></i> 位置</td>
                    <td id="value_wz" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-calculator"></i> 预期价格</td>
                    <td id="value_yqjg" class="zzn-content"></td>
                </tr>
                <tr>
                    <td><i class="fa fa-child"></i> 性别</td>
                    <td id="value_xb" class="zzn-content"></td>
                </tr>
                <tr>
                    <td colspan="2"><i class="fa fa-user"></i> 个人介绍</td>
                </tr>
                <tr>
                    <td  colspan="2">
                        <p><span id="value_grjs"></span></p>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <button id="btn_first" class="btn btn-success col-xs-3 col-sm-3 col-md-3 col-lg-3"><i class="fa fa-fast-backward"></i> 最旧</button>

                        <button id="btn_prev" class="btn btn-success col-xs-3 col-sm-3 col-md-3 col-lg-3"><i class="fa fa-angle-left"></i> 上一个</button>

                        <button id="btn_last"  class="btn btn-primary col-xs-3 col-sm-3 col-md-3 col-lg-3 pull-right">最新 <i class="fa fa-fast-forward"></i></button>
                        <button id="btn_next"  class="btn btn-primary col-xs-3 col-sm-3 col-md-3 col-lg-3 pull-right">下一个 <i class="fa fa-angle-right"></i></button>

                    </td>
                </tr>
            </table>
        </div>
    </div>
    </div>

</div>
<div class="height-100px"></div>
<h5 style="text-align: center">
    maintained by <a href="//www.zzn.im">Zainan Zhou</a>
    <a href="https://www.linkedin.com/in/zainanvictorzhou/"><i class="fa fa-linkedin-square"></i></a>
</h5>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">敬请期待</h4>
            </div>
            <div class="modal-body">
                <p>搜索功能尚在开发中 ：）</p>
                <p>点击<a href="http://rent.zzn.im">这里</a>填表或者看表</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<script src="jquery-2.1.1.min.js"></script>
<script src="jquery.cookie.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="purl.js"></script>
<script src="//www.parsecdn.com/js/parse-1.3.0.min.js"></script>
<script src="guid.js"></script>
<!-- Start of Woopra Code -->
<script>
    (function () {
        var t, i, e, n = window, o = document, a = arguments, s = "script", r = ["config", "track", "identify", "visit", "push", "call", "trackForm", "trackClick"], c = function () {
            var t, i = this;
            for (i._e = [], t = 0; r.length > t; t++)(function (t) {
                i[t] = function () {
                    return i._e.push([t].concat(Array.prototype.slice.call(arguments, 0))), i
                }
            })(r[t])
        };
        for (n._w = n._w || {}, t = 0; a.length > t; t++)n._w[a[t]] = n[a[t]] = n[a[t]] || new c;
        i = o.createElement(s), i.async = 1, i.src = "//static.woopra.com/js/w.js", e = o.getElementsByTagName(s)[0], e.parentNode.insertBefore(i, e)
    })("woopra");

    woopra.config({
        domain: 'rent.zzn.im'
    });

    woopra.track();
</script>
<!-- End of Woopra Code -->

<script>
    jQuery(function ($) {
        $(document).ready(function () {
            Parse.initialize("RPjt04MBMl3rzzEKBGKUpP7KHFXAsomtDbr9cS0y", "DSqWg9xElC6mI1PwtPWzzeIPQYUXPGTOC66nT82h");

            var myId = $.cookie("myId") || guid();
            $.cookie("myId", myId);
            var parseTrack = function(action, data) {
                var ParseTracking = Parse.Object.extend("ParseTracking");
                var parseTracking = new ParseTracking();
                parseTracking.set("client_id", myId);
                parseTracking.set("location", purl().attr("source"));
                parseTracking.set("userAgent", navigator.userAgent);
                parseTracking.set("timestamp", new Date());
                parseTracking.set("action", action);
                parseTracking.set("data", data);
                parseTracking.save().then(function() {
                    console.log("saved data");
                });
            };

            // Init view
            parseTrack("view");

            var geoinfo = {};

            $.getJSON("http://www.telize.com/geoip?callback=?",
                    function (jsonp) {
                        geoinfo.ip = jsonp.ip;
                        geoinfo.city = jsonp.city;
                        geoinfo.country = jsonp.country;
                        geoinfo.gmapurl = "http://maps.google.com/?q=" + geoinfo.latitude + "," + geoinfo.longitude;

                        var strgeoinfo = JSON.stringify(strgeoinfo);
                        ga('send', 'event', 'button', 'click', 'view-geo',{ "strgeoinfo": strgeoinfo});
                        woopra.track('view-geo', { "strgeoinfo": strgeoinfo});
                        parseTrack("view-geo", {
                            strgeoinfo: strgeoinfo,
                            ip: geoinfo.ip,
                            city: geoinfo.city,
                            country: geoinfo.country
                        })

                    }
            );

            $.ajaxPrefilter(function(options) {
                if(options.crossDomain && jQuery.support.cors) {
                    var http = (window.location.protocol === 'http:' ? 'http:' : 'https:');
                    options.url = http + '//cors-anywhere.herokuapp.com/' + options.url;
                    //options.url = "http://cors.corsproxy.io/url=" + options.url;
                }
            });
            var url = "https://spreadsheets.google.com/feeds/list/1vzugrYLpgXmFODqysSx331Lhq8LpDQGJ4sQtwSMrtV4/1/public/values?alt=json";
            var columns = {
              xq: "gsx$需求类别",
              qssj: "gsx$预计起始日期超过这个日期本条信息失效",
              wz: "gsx$位置",
              yqjg: "gsx$预期价格美元每月",
              grjs: "gsx$租房需求介绍和自我介绍",
              wxId: "gsx$微信号",
              xb: "gsx$性别",
              dhyx: "gsx$其他联系方式电话邮箱等"
            };
            var setLoad = function() {
                for (var col in columns) {
                    $("#value_" + col).text("");
                }
            };

            var row = 1;
            setLoad();
            $.get(url, function(data) {
                var pageRow = parseInt(purl().param("row"));
                var currentIndex = 0;
                var refreshPage = function(row) {
                    $("#btn_next").show();
                    $("#btn_prev").show();
                    if (row == data.feed.entry.length-1) {
                        $("#btn_next").hide();
                    } else if (row == 0) {
                        $("#btn_prev").hide();
                    } else if(row < 0 || row >= data.feed.entry.length) {
                        //TODO(zzn) handle error URL
                    }
                    var getCell = function(row, col) {
                        return data.feed.entry[row][columns[col]]["$t"] || "N/A";
                    };

                    for (var col in columns) {
                        $("#value_" + col).text(getCell(row, col));
                    }
                    $("#value_panel_title").text("(" + (row) + "/" + data.feed.entry.length + ") 湾区租房互助信息");
                    $("#value_title").text(data.feed.entry[row][columns.xq]["$t"] + "-" + data.feed.entry[row][columns.wz]["$t"]);

                };
                $("#btn_prev").click(function(){
                    currentIndex -= 1;
                    refreshPage(pageRow + currentIndex);
                });
                $("#btn_next").click(function(){
                    currentIndex += 1;
                    refreshPage(pageRow + currentIndex);
                });
                $("#btn_last").click(function(){
                    currentIndex = data.feed.entry.length - pageRow - 1;
                    refreshPage(pageRow + currentIndex);
                });
                $("#btn_first").click(function(){
                    currentIndex = 0 - pageRow;
                    refreshPage(pageRow + currentIndex);
                });

                refreshPage(pageRow + currentIndex);
            });

        });
    });
</script>

<!-- Google Tag Manager -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-PVD5TJ"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
    var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
            '//www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-PVD5TJ');</script>
<!-- End Google Tag Manager -->

</body>
</html>